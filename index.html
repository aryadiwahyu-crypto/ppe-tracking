<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PPE Tracking - PT. TRAFOINDO POWER INDONESIA</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background-color: #f4f6f8; padding: 20px; font-family: 'Segoe UI', sans-serif; }
    .card { border-radius: 15px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
    table { font-size: 14px; }
    .highlight { background-color: #fff3cd !important; }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="text-center mb-4">ðŸ“‹ Riwayat Penerimaan Alat Pelindung Diri</h2>
    
    <div class="card p-3 mb-3">
      <div class="row g-2 align-items-center">
        <div class="col-md-6">
          <input type="text" id="searchName" class="form-control" placeholder="Ketik nama karyawan..." />
        </div>
        <div class="col-md-3">
          <select id="filterAPD" class="form-select">
            <option value="">Semua Jenis APD</option>
          </select>
        </div>
        <div class="col-md-3 text-end">
          <button id="btnReset" class="btn btn-secondary w-100">Reset</button>
        </div>
      </div>
    </div>

    <div id="dataTable" class="card p-3">
      <div class="table-responsive">
        <table class="table table-bordered table-hover">
          <thead class="table-dark">
            <tr id="tableHead"></tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const searchName = document.getElementById("searchName");
    const filterAPD = document.getElementById("filterAPD");
    const tableHead = document.getElementById("tableHead");
    const tableBody = document.getElementById("tableBody");
    const btnReset = document.getElementById("btnReset");
    let allData = [];

    fetch("data/apd_normalized.json")
      .then(res => res.json())
      .then(data => {
        allData = data;
        renderTable(allData);
        populateAPDFilter(allData);
      });

    function renderTable(data) {
      tableBody.innerHTML = "";
      if (data.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="100%" class="text-center text-muted">Tidak ada data ditemukan</td></tr>`;
        return;
      }
      const headers = Object.keys(data[0]);
      tableHead.innerHTML = headers.map(h => `<th>${h}</th>`).join("");

      data.forEach(row => {
        const tr = document.createElement("tr");
        headers.forEach(h => {
          const td = document.createElement("td");
          td.textContent = row[h] || "";
          tr.appendChild(td);
        });
        tableBody.appendChild(tr);
      });
    }

    function populateAPDFilter(data) {
      const apdList = new Set();
      data.forEach(row => {
        Object.keys(row).forEach(k => {
          if (k.includes("__")) apdList.add(k.split("__")[0]);
        });
      });
      apdList.forEach(apd => {
        const opt = document.createElement("option");
        opt.value = apd;
        opt.textContent = apd;
        filterAPD.appendChild(opt);
      });
    }

    searchName.addEventListener("input", () => applyFilters());
    filterAPD.addEventListener("change", () => applyFilters());
    btnReset.addEventListener("click", () => {
      searchName.value = "";
      filterAPD.value = "";
      renderTable(allData);
    });

    function applyFilters() {
      const nameVal = searchName.value.toLowerCase();
      const apdVal = filterAPD.value;
      const filtered = allData.filter(row => {
        const matchName = Object.values(row).some(v => v && v.toLowerCase().includes(nameVal));
        const matchAPD = !apdVal || Object.keys(row).some(k => k.startsWith(apdVal));
        return matchName && matchAPD;
      });
      renderTable(filtered);
    }
  </script>
</body>
</html>
